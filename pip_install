#!/bin/sh
set -ex

ZUUL_CLONER=/usr/zuul-env/bin/zuul-cloner

mkdir -p .test-tars

if $(python -c "import ironic" 2> /dev/null); then
    echo "Ironic already installed."
elif [ -x $ZUUL_CLONER ]; then
    $ZUUL_CLONER --cache-dir /opt/git --workspace /tmp git://git.openstack.org openstack/ironic
    ( cd /tmp/openstack/ironic; git checkout stable/liberty )
    pip install /tmp/openstack/ironic
else
    ( cd .test-tars && wget -N http://tarballs.openstack.org/ironic/ironic-stable-liberty.tar.gz )
    pip install .test-tars/ironic-stable-liberty.tar.gz
fi

if $(python -c "import nova" 2> /dev/null); then
    echo "Nova already installed."
elif [ -x $ZUUL_CLONER ]; then
    $ZUUL_CLONER --cache-dir /opt/git --workspace /tmp git://git.openstack.org openstack/nova
    ( cd /tmp/openstack/nova; git checkout stable/liberty )
    pip install /tmp/openstack/nova
else
    ( cd .test-tars && wget -N http://tarballs.openstack.org/nova/nova-stable-liberty.tar.gz )
    pip install .test-tars/nova-stable-liberty.tar.gz
fi

pip install -U $*

exit $?
